# 定时任务设置

系统中的涉及到的定时任务采用了类Linux
Crontab的表达格式，使得开发者能够快速理解掌握定时任务表达式技巧。但需要注意的是，由于定时任务模块是基于代码层面的控制，因此控制的粒度会更细，最小粒度到秒，格式被划分为了6段。而Linux
Crontab是基于程序层面的控制，最小粒度到分，格式被划分为了5段。

[在线Cron表达式生成器](https://cron.qqe2.com/)

[Cron表达式校验工具](https://www.bejson.com/othertools/cronvalidate/)


## 基本介绍

`cron表达式`表示一组时间，使用`6`个空格分隔的字段。 


```xml
Seconds Minutes Hours Day Month Week
```

> 即 `秒 分 时  日 月 周`

每个字段的含义如下：

```xml
Field name    | Allowed values  | Allowed special characters
        ----------    | --------------  | --------------------------
        Seconds       | 0-59            | * / , -
        Minutes       | 0-59            | * / , -
        Hours         | 0-23            | * / , -
        Day           | 1-31            | * / , - ?
        Month         | 1-12 or JAN-DEC | * / , -
        Week          | 0-6 or SUN-SAT  | * / , - ?
```

注意：月份和星期几字段值不区分大小写。 `SUN`、`Sun` 和`sun`同样被接受。

有些子表达式能包含一些范围或列表

例如：子表达式（天（星期））可以为 “MON-FRI”，“MON，WED，FRI”，“MON-WED,SAT”

## 特殊字符

### 星号（`*`）

星号表示`cron`表达式将匹配所有的值。例如，在第五个字段(`Month`)中使用星号表示每个月。

因此，“*”在子表达式（月）里表示每个月的含义，“*”在子表达式（天（星期））表示星期的每一天

### 斜线（`/`）

斜杠用于描述范围的增量。例如：第二个字段使用`3-59/15`表示每小时的第3分钟开始到第59分钟，每隔15分钟执行。

### 逗号（`,`）

逗号用于分隔列表的项目。例如，第五个字段使用`MON,WED,FRI`将指每周一，周三和周五执行。

### 连字符（`-`）

连字符用于定义范围。例如，第三个字段使用`9-17`表示每天上午`9`点至下午`5`点（含）。

### 问号（`?`）

可以使用`问号`而不是`*`来让`Day`或`Week`字段为空。

“？”字符仅被用于天（月）和天（星期）两个子表达式，表示不指定值 
　　当2个子表达式其中之一被指定了值以后，为了避免冲突，需要将另一个子表达式的值设为“？”

### L字符（`L`）

“L” 字符仅被用于天（月）和天（星期）两个子表达式，它是单词“last”的缩写 
　　但是它在两个子表达式里的含义是不同的。 
　　在天（月）子表达式中，“L”表示一个月的最后一天 
　　在天（星期）自表达式中，“L”表示一个星期的最后一天，也就是SAT

如果在“L”前有具体的内容，它就具有其他的含义了

例如：“6L”表示这个月的倒数第６天，“FRIL”表示这个月的最一个星期五 
　　注意：在使用“L”参数时，不要指定列表或范围，因为这会导致问题

### 预定义格式

您可以使用几个预定义的时间来代替cron表达式。

```xml
Entry                  | Description                                | Equivalent To
        -----                  | -----------                                | -------------
        @yearly (or @annually) | Run once a year, midnight, Jan. 1st        | 0 0 0 1 1 *
        @monthly               | Run once a month, midnight, first of month | 0 0 0 1 * *
        @weekly                | Run once a week, midnight between Sat/Sun  | 0 0 0 * * 0
        @daily (or @midnight)  | Run once a day, midnight                   | 0 0 0 * * *
        @hourly                | Run once an hour, beginning of hour        | 0 0 * * * *
```

### 间隔

您还可以定义任务以固定的时间间隔执行，从添加时开始运行。这可以通过格式化`cron`规范来支持，如下所示：

```xml
@every
<duration>
```

其中`duration`是`time.ParseDuration`接受的字符串 （http://golang.org/pkg/time/#ParseDuration）。

例如，`@every 1h30m10s`将表示添加任务之后每隔`1小时30分10秒`执行。

> 注意：间隔不会考虑任务的执行时间。例如，如果一项工作需要3分钟才能执行完成，并且计划每隔5分钟运行一次，那么每次任务之间只有2分钟的空闲时间。

## 表达式示例

| 表达式示例          | 表达式说明                              |
| :------------------ | :-------------------------------------- |
| `* * * * * *`       | 每秒执行                                |
| `2 * * * * *`       | 每分钟的第`2`秒执行                     |
| `*/5 * * * * *`     | 每`5`秒执行一次                         |
| `0 */30 * * * *`    | 每`30`分钟执行一次                      |
| `0 0 2 * * *`       | 每天凌晨`2`点执行                       |
| `0 */30 9-18 * * *` | 每天`9`点到`18`点，每隔`30`分钟执行一次 |
| `0 0 9 * * MON,FRI` | 每`周一`和`周五`在`9`点执行一次         |

更多cron表达式例子

| 表达式示例          | 表达式说明                              |
| :------------------ | :-------------------------------------- |
|0 0 10,15,16 * * ? |每天上午10点，下午3点，4点|
|0 0/30 9-17 * * ? |朝九晚五工作时间内每半小时|
|0 0 12 ? * WED |表示每个星期三中午12点|
|0 0 12 * * ? |每天中午12点触发|
|0 15 10 ? * * |每天上午10:15触发|
|0 15 10 * * ? |每天上午10:15触发 （跟上面的一样）|
|0 15 10 * * ? |2005 2005年的每天上午10:15触发|
|0 * 14 * * ? |在每天下午2点到下午2:59期间的每1分钟触发|
|0 0/5 14 * * ? |在每天下午2点到下午2:55期间的每5分钟触发|
|0 0/5 14,18 * * ? |在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发|
|0 0-5 14 * * ? |在每天下午2点到下午2:05期间的每1分钟触发|
|0 10,44 14 ? 3 WED |每年三月的星期三的下午2:10和2:44触发|
|0 15 10 ? * MON-FRI |周一至周五的上午10:15触发|
|0 15 10 15 * ? |每月15日上午10:15触发|
|0 15 10 L * ? |每月最后一日的上午10:15触发|
|0 15 10 ? * 6L |每月的最后一个星期五上午10:15触发|
|0 15 10 ? * 6L 2002-2005 |2002年至2005年的每月的最后一个星期五上午10:15触发|

