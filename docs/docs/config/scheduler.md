---
title: '定时任务'
hide_title: true
sidebar_position: 2
keywords: [定时任务,任务调度,Cron表达式,自动化任务,任务管理,调度系统,定时执行,任务配置,系统任务,周期任务]
description: '详细说明SagooIOT平台的定时任务功能，包括任务的创建、修改、删除和调度配置等任务管理指南。'
---
# 定时任务

## 定时任务说明

定时任务是指系统或应用程序按照预定的时间计划执行的自动化任务或操作。这些任务可以周期性地执行，也可以在特定的日期和时间点执行。


## 新增任务

1. 请确保已登录SagooIOT物联网平台。

2. 在左侧导航栏中，选择系统配置->定时任务

3. 新增任务
点击“新增任务”按钮。
  ![新增任务按钮](./img/timed-tasks/add-task-button.png)
在弹出的对话框中，输入必填项。
  ![新增任务](./img/timed-tasks/add-task.png)
确定后，系统将创建并显示新的任务。

| 任务名称   | 描述                                        |
|--------|-------------------------------------------|
| 任务名称   | 必填输入框，是对任务名称进行定义。                         |
| 任务描述   | 非必填输入框，是对任务描述进行定义。                        |
| 任务分组   | 非必选框，是对任务分组进行定义。                          |
| 调用方法   | 必选框，是对调用方法进行定义。                           |
| 执行参数   | 非必填输入框，是对执行参数进行定义。                        |
| cron表达式 | 必填输入框，是对任务cron表达式进行定义。表达式可以参考【[定时任务设置](/docs/other/cron)】 |
| 执行策略   | 非必选，是对任务的执行策略进行定义。                        |
| 状态     | 非必选框，是对任务是否启用进行定义。                        |

:::note 备注
建议采用配置界面进行配置，不直接输入，避免设置错误
:::

## 修改任务信息

如果需要编辑任务的名称或其他信息，可以在任务列表项点击“修改”按钮进行修改。
  ![修改任务](./img/timed-tasks/modify-task.png)

## 删除任务信息

如果需要删除任务的信息，可以在任务列表项点击“删除”按钮进行删除。
  ![删除任务](./img/timed-tasks/delete-task.png)

## 执行一次

如果需要立即执行任务，可以在任务列表项点击“执行一次”按钮进行执行。


## 任务类型详细说明

### 日志清理类任务

#### 操作日志清理 (ClearOperationLogByDays)

- 功能：清理系统中超过指定天数的操作日志
- 参数：days (天数)
- 建议执行周期：每天凌晨执行
- 使用场景：用于定期清理过期的系统操作记录，释放数据库空间

#### 通知日志清理 (ClearNoticeLogByDays)

- 功能：清理系统中超过指定天数的通知服务日志
- 参数：days (天数)
- 建议执行周期：每天凌晨执行
- 使用场景：清理过期的系统通知记录，优化系统性能

#### 告警日志清理 (ClearAlarmLogByDays)

- 功能：清理系统中超过指定天数的告警日志
- 参数：days (天数)
- 建议执行周期：每天凌晨执行
- 使用场景：清理历史告警记录，保持告警系统高效运行

#### TD引擎日志清理 (ClearTDengineLogByDays)

- 功能：清理TDengine数据库中超过指定天数的日志数据
- 参数：days (天数)
- 建议执行周期：每天凌晨执行
- 使用场景：维护时序数据库性能，清理过期数据

#### 设备日志清理 (DeviceLogClear)

- 功能：清理设备运行产生的日志数据
- 参数：无需额外参数
- 建议执行周期：根据设备日志量决定，建议每天或每周执行
- 使用场景：维护设备管理系统性能，避免日志数据过度累积

### 数据处理类任务

#### 数据源同步 (DataSourceSync)

- 功能：自动同步指定数据源的数据
- 参数：sid (数据源ID)
- 建议执行周期：根据数据源更新频率设置
- 使用场景：
  - 定期从外部数据源获取最新数据
  - 保持数据源数据的实时性
  - 自动化数据采集流程

#### 数据模型聚合 (DataTemplate)

- 功能：执行数据模型的聚合操作
- 参数：tid (模板ID)
- 建议执行周期：根据业务需求设置
- 使用场景：
  - 数据仓库的定时聚合计算
  - 业务报表的数据准备
  - 大数据分析的预处理

#### SQL定时执行 (ExecuteSQL)

- 功能：按计划执行预设的SQL语句
- 参数：sqlStr (SQL语句)
- 建议执行周期：根据SQL操作类型和业务需求设置
- 使用场景：
  - 定期数据统计
  - 数据库维护操作
  - 自动化报表生成

### 统计分析类任务

#### 告警日志统计 (AlarmLogStatistics)

- 功能：执行每日告警日志的统计分析
- 参数：
  - startDate (开始日期)
  - endDate (结束日期)
- 建议执行周期：每天凌晨执行
- 特点：
  - 统计当日告警情况并存入业务表
  - 保存近6个月的业务数据
- 使用场景：
  - 生成告警趋势分析
  - 系统运行状态监控
  - 设备故障分析

#### 告警统计清除 (AlarmDailyStatsRemove)

- 功能：清除超过6个月的告警统计数据
- 参数：无需额外参数
- 建议执行周期：每天凌晨执行
- 使用场景：
  - 自动维护告警统计数据的存储周期
  - 优化数据库存储空间
  - 确保统计数据的时效性

### 任务执行注意事项

1. 数据清理类任务建议在系统负载较低时执行
2. 设置任务执行时间时要避免任务之间的时间冲突
3. 重要数据的清理任务建议先进行数据备份
4. 统计分析类任务建议设置失败重试机制
5. SQL执行任务需要经过严格测试，避免影响系统性能

### 任务参数配置建议

1. 日志清理天数建议：
  - 操作日志：30-90天
  - 告警日志：90-180天
  - 通知日志：30-60天
2. 统计任务执行时间建议在凌晨2-4点之间
3. 数据源同步频率根据数据实时性要求设置，一般建议：
  - 高实时性要求：每5-15分钟
  - 一般实时性要求：每小时
  - 低实时性要求：每天
