---
title: '节点组'
sidebar_position: 4
hide_title: true
keywords: [规则引擎,节点组,并行处理,异步执行,结果合并,超时控制,条件匹配,任务分组,资源管理,错误处理]
description: '详细介绍SagooIOT平台规则引擎中节点组的功能特性，包括并行处理机制、结果合并策略、匹配条件配置、超时控制等内容，帮助用户实现复杂的并行任务处理和资源优化。'
---

## 节点说明

节点组是一个强大的并行处理组件，可以将多个节点组合成一个分组，实现异步并行执行。它能够等待所有节点执行完成后，合并执行结果并根据配置条件决定后续处理流程。

## 界面配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符（示例中为 "node_50"）
- **名称**: 节点组的显示名称
- **调试模式**: 可开启调试模式查看执行结果

### 2. 匹配条件配置

- **匹配类系**: 设置需要匹配的关系类型（默认Success）
- **匹配满足节点数量**: 设置需要满足条件的节点数量
- **组内节点ID列表**: 选择要包含在组内的节点
- **组内执行超时**: 设置执行超时时间（秒）

## 执行模式说明

### 1. 并行执行

```
特点：
- 同时执行所有组内节点
- 互不干扰，独立运行
- 提高处理效率
```

### 2. 结果合并

```
合并规则：
- 元数据(metadata)合并
- 消息内容(data)合并
- 错误信息收集
```

### 3. 超时控制

```
超时设置：
- 0: 无超时限制
- >0: 指定秒数后超时
- 超时后进入Failure路由
```

## 匹配条件配置

### 1. 匹配数量(matchNum)

```
0: 所有节点都必须满足条件
N: N个节点满足条件即可
>=总节点数: 等同于要求所有节点满足
```

### 2. 匹配关系(matchRelationType)

```
Success: 匹配成功路由
其他: 可配置其他关系类型
```

## 使用场景示例

### 1. 数据并行处理

```
场景：同时处理多个数据源
配置：
- 节点列表：[数据处理1, 数据处理2, 数据处理3]
- 匹配数量：3
- 匹配关系：Success
```

### 2. 条件验证

```
场景：多条件并行验证
配置：
- 节点列表：[验证1, 验证2, 验证3]
- 匹配数量：1
- 匹配关系：Success
```

### 3. 并行任务执行

```
场景：多任务并行执行
配置：
- 节点列表：[任务1, 任务2, 任务3]
- 匹配数量：0
- 超时时间：60
```

## 结果处理说明

### 1. 元数据合并

```
规则：
- 合并所有节点的metadata
- 相同key后执行节点覆盖先执行节点
```

### 2. 消息封装

```
WrapperMsg结构：
- msg: 处理后的消息
- err: 错误信息
- nodeId: 处理节点ID
```

## 最佳实践

### 1. 组内节点设计

- 选择合适的节点组合
- 控制节点数量
- 注意执行顺序

### 2. 超时设置

- 根据任务复杂度设置
- 预留足够缓冲时间
- 考虑异常处理时间

### 3. 匹配条件设置

- 合理设置匹配数量
- 选择适当的关系类型
- 考虑失败处理策略

## 注意事项

1. **性能考虑**
    - 控制并行节点数量
    - 注意资源消耗
    - 合理设置超时时间
2. **错误处理**
    - 处理节点执行错误
    - 超时情况处理
    - 结果合并异常
3. **资源管理**
    - 控制内存使用
    - 管理并发数量
    - 避免资源竞争

## 调试建议

1. **开启调试模式**
    - 观察节点执行情况
    - 检查结果合并
    - 验证匹配条件
2. **常见问题排查**
    - 检查节点配置
    - 验证超时设置
    - 确认匹配条件
3. **性能监控**
    - 观察执行时间
    - 检查资源使用
    - 监控并发情况

## 路由说明

### 1. Success路由

触发条件：

- 满足匹配数量要求
- 所有节点执行完成
- 未发生超时

### 2. Failure路由

触发条件：

- 节点列表为空
- 执行超时
- 不满足匹配条件
- 节点执行错误

节点组是一个强大的并行处理工具，通过合理配置可以实现复杂的并行任务处理。使用时要注意性能和资源管理，选择合适的匹配条件和超时设置，确保处理结果的正确性和可靠性。
