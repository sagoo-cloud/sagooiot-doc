---
title: 'For'
sidebar_position: 2
hide_title: true
keywords: [规则引擎,规则链,golang,go语言,编排式,热部署,数据集成,IoT,物联网平台,组件化,流程自动化,自动化引擎,应用集成,事件框架]
description: '轻量级、高性能、嵌入式、新一代组件编排规则引擎'
---



## 节点说明

遍历节点是一个强大的循环处理组件，可以遍历数组、切片和结构体，也可以用于重复执行特定节点或子规则链。它提供了灵活的遍历方式和结果处理机制。

## 界面配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符（示例中为 "node_46"）
- **名称**: 节点的显示名称
- **调试模式**: 可开启调试模式查看执行结果

### 2. 核心配置

- **迭代值表达式**: 指定要遍历的目标
- **处理节点ID**: 处理每个元素的节点或子规则链
- **执行模式**: 选择遍历结果的处理方式

## 遍历表达式配置

### 1. 基本语法

```


# 数字范围遍历
1..3           // 遍历 [1,2,3]

# 数组遍历
msg.items      // 遍历消息中的items数组

# 元数据遍历
metadata.list  // 遍历元数据中的list字段
```

### 2. 支持变量

```


id        - 消息ID
ts        - 时间戳
data      - 原始内容
msg       - 消息体
metadata  - 元数据
type      - 消息类型
dataType  - 数据类型
```

## 四、执行模式说明

### 1. 忽略模式 (mode=0)

```


特点：
- 不合并遍历结果
- 保持原始消息不变
- 适合只关注处理过程的场景
```

### 2. 追加模式 (mode=1)

```


特点：
- 将每次遍历结果追加到数组
- 保留所有处理结果
- 适合需要收集所有结果的场景
```

### 3. 覆盖模式 (mode=2)

```


特点：
- 使用最后一次结果覆盖
- 只保留最终结果
- 适合只需要最终结果的场景
```

### 4. 异步模式 (mode=3)

```

特点：
- 异步执行每次遍历
- 不等待执行完成
- 适合并行处理场景
```

## 使用场景示例

### 1. 批量数据处理

```


迭代值表达式：msg.items
处理节点：dataProcess
执行模式：追加模式
目的：处理数组中的每个数据项
```

### 2. 重复执行任务

```

迭代值表达式：1..5
处理节点：taskNode
执行模式：忽略模式
目的：重复执行特定任务5次
```

### 3. 并行处理

```


迭代值表达式：msg.tasks
处理节点：chain:processChain
执行模式：异步模式
目的：并行处理多个任务
```

## 遍历信息获取

### 1. 元数据访问

在遍历过程中可通过metadata获取：

```


_loopIndex  - 当前索引
_loopItem   - 当前元素值
_loopKey    - 当前键名（结构体遍历时）
```

### 2. 使用示例

```


在处理节点中：
当前索引：${metadata._loopIndex}
当前值：${metadata._loopItem}
当前键：${metadata._loopKey}
```

## 最佳实践

### 1. 遍历设计

- 选择合适的遍历表达式
- 合理设置遍历范围
- 注意数据类型匹配

### 2. 性能优化

- 适当使用异步模式
- 控制遍历数量
- 避免过深的嵌套

### 3. 结果处理

- 根据需求选择执行模式
- 正确处理遍历结果
- 注意数据一致性

## 注意事项

1. **遍历控制**
    - 避免过大的遍历范围
    - 注意循环终止条件
    - 处理异常情况
2. **数据处理**
    - 验证数据类型
    - 处理空值情况
    - 保持数据一致性
3. **资源管理**
    - 控制内存使用
    - 管理并发数量
    - 避免资源泄露

## 调试建议

1. **开启调试模式**
    - 观察遍历过程
    - 检查元素处理
    - 验证结果合并
2. **常见问题排查**
    - 检查表达式语法
    - 验证节点配置
    - 确认模式设置
3. **性能监控**
    - 观察执行时间
    - 检查资源使用
    - 监控并发情况

## 路由说明

### 1. Success路由

- 遍历成功完成
- 结果正确处理
- 可以继续后续处理

### 2. Failure路由

- 表达式错误
- 处理节点失败
- 需要错误处理

遍历节点是一个功能强大的组件，通过合理配置可以实现复杂的批处理和循环任务。在使用时要注意性能和资源管理，选择合适的执行模式，确保处理结果的正确性。
