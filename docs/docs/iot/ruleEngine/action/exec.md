---
title: '命令行'
sidebar_position: 1
hide_title: true
keywords: [规则引擎,命令执行,系统命令,自动化运维,命令行节点,命令白名单,安全执行,参数配置,命令输出,脚本执行]
description: '详细介绍SagooIOT平台规则引擎中命令行节点的功能和使用方法，包括命令配置、安全机制、参数设置、使用场景、最佳实践等内容，帮助用户安全高效地执行系统命令和脚本。'
---


## 节点说明

命令执行节点用于在规则链中执行系统命令和脚本，是实现自动化运维、数据处理、持续集成等场景的重要组件。该节点提供了安全的命令执行机制，支持参数配置和输出控制。

## 界面配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符（示例中为 "node_44"）
- **名称**: 节点的显示名称
- **调试模式**: 可开启调试模式查看执行结果

### 2. 命令配置

- **执行命令**: 要执行的系统命令
- **命令参数**: 可添加多个命令参数
- **打印标准输出**: 是否记录命令输出
- **替换Data**: 是否用命令输出替换消息内容

### 3. 参数设置

支持使用变量替换：

- `${metadata.key}`: 使用元数据中的值
- `${msg.key}`: 使用消息内容中的值

## 安全机制

### 1. 命令白名单

```
配置方式：
config.Properties.PutValue(KeyExecNodeWhitelist, "cmd1,cmd2")

特点：
- 只允许执行白名单内的命令
- 多个命令用逗号分隔
- 非白名单命令将被拒绝
```

### 2. 工作目录控制

```
设置方式：
Metadata.PutValue("workDir", "./data")

作用：
- 限制命令执行范围
- 保护系统安全
- 便于管理输出
```

## 四、使用场景示例

### 1. 文件处理

```
命令：grep
参数：["error", "app.log"]
工作目录：/var/log
用途：搜索日志文件中的错误信息
```

### 2. 系统监控

```
命令：df
参数：["-h"]
打印输出：true
用途：监控磁盘使用情况
```

### 3. 数据处理

```
命令：python
参数：["process_data.py", "${msg.filename}"]
替换Data：true
用途：调用Python脚本处理数据
```

## 高级特性

### 1. 动态参数配置

```
命令参数示例：
- 固定参数：["--port", "8080"]
- 动态参数：["--file", "${msg.filename}"]
- 混合使用：["--env", "${metadata.env}", "--mode", "prod"]
```

### 2. 输出控制

```
标准输出控制：
- 打印输出=true：记录到日志
- 替换Data=true：替换消息内容
- 两者都为false：仅在metadata中保存
```

### 3. 超时控制

```
timeout设置：
- 0：无超时限制
- >0：指定秒数后超时
- 超时后：转入Failure路由
```

## 最佳实践

### 1. 安全配置

- 严格限制白名单命令
- 使用相对路径
- 控制执行权限

### 2. 错误处理

- 设置合理的超时时间
- 处理命令执行失败情况
- 记录错误输出

### 3. 性能优化

- 避免长时间运行的命令
- 合理使用输出控制
- 及时清理临时文件

## 注意事项

1. **安全性**
    - 仅允许必要的命令
    - 避免执行危险操作
    - 注意参数注入风险
2. **资源管理**
    - 控制执行时间
    - 管理内存使用
    - 清理临时文件
3. **错误处理**
    - 捕获执行异常
    - 处理超时情况
    - 记录错误信息

## 调试建议

1. **开启调试模式**
    - 查看命令执行过程
    - 检查参数替换结果
    - 验证输出内容
2. **常见问题排查**
    - 检查命令白名单
    - 验证工作目录
    - 确认参数正确性
3. **性能监控**
    - 观察执行时间
    - 检查资源使用
    - 监控输出大小

## 路由说明

### 1. Success路由

- 命令执行成功
- 返回状态码为0
- 输出正常获取

### 2. Failure路由

触发条件：

- 命令不在白名单中
- 执行返回非零状态码
- 执行超时
- 工作目录不存在

命令执行节点是一个强大的自动化工具，但需要谨慎使用并注意安全配置。合理使用可以实现复杂的系统集成和自动化任务，提高系统的自动化程度和运维效率。
