---
title: '合并'
sidebar_position: 5
hide_title: true
keywords: [规则引擎,规则链,golang,go语言,编排式,热部署,数据集成,IoT,物联网平台,组件化,流程自动化,自动化引擎,应用集成,事件框架]
description: '轻量级、高性能、嵌入式、新一代组件编排规则引擎'
---


## 节点说明

全并（汇聚）节点是一个专门用于合并多个异步并行执行节点结果的组件。它能够等待所有前置节点执行完成，并将它们的结果进行合并处理。这个组件特别适用于需要整合多个数据源或并行API调用结果的场景。

## 界面配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符（示例中为 "node_54"）
- **名称**: 节点的显示名称
- **调试模式**: 可开启调试模式查看执行结果

### 2. 超时配置

- **执行超时时间**: 设置等待前置节点的最大时间（秒）
- **默认值**: 0（表示不设置超时）

## 工作机制

### 1. 等待机制

```
特点：
- 等待所有前置异步节点完成
- 收集所有节点的执行结果
- 支持超时控制
```

### 2. 合并处理

```
合并规则：
- 合并所有节点的metadata
- 合并所有节点的data
- 保留每个节点的执行状态
```

## 使用场景示例

### 1. 多数据源整合

```
场景：整合多个数据库的查询结果
配置：
- 前置节点：[MySQL查询, MongoDB查询, Redis查询]
- 超时时间：30秒
目的：将多个数据源的结果合并处理
```

### 2. 并行API调用

```
场景：同时调用多个外部服务
配置：
- 前置节点：[服务A调用, 服务B调用, 服务C调用]
- 超时时间：10秒
目的：整合多个服务的响应结果
```

### 3. 数据聚合处理

```
场景：多维度数据分析
配置：
- 前置节点：[维度1分析, 维度2分析, 维度3分析]
- 超时时间：60秒
目的：汇总多个维度的分析结果
```

## 结果处理说明

### 1. 元数据合并

```
规则：
- 合并所有节点的metadata
- 相同key后执行节点覆盖先执行节点
- 保持数据一致性
```

### 2. 消息封装

```
WrapperMsg结构包含：
- msg: 节点处理后的消息
- err: 错误信息（如果有）
- nodeId: 处理节点的标识
```

## 最佳实践

### 1. 超时设置

- 根据业务复杂度设置合理超时时间
- 考虑网络延迟和处理时间
- 预留足够的缓冲时间

### 2. 错误处理

- 妥善处理节点执行失败情况
- 设置合适的失败处理策略
- 记录详细的错误信息

### 3. 性能优化

- 控制并行节点数量
- 优化数据处理逻辑
- 合理分配资源

## 注意事项

1. **数据一致性**
    - 确保数据合并的正确性
    - 处理数据冲突情况
    - 维护数据完整性
2. **资源管理**
    - 控制内存使用
    - 避免资源泄露
    - 管理并发数量
3. **异常处理**
    - 处理超时情况
    - 处理节点失败
    - 合并异常处理

## 调试建议

1. **开启调试模式**
    - 观察节点执行状态
    - 检查数据合并结果
    - 监控执行时间
2. **常见问题排查**
    - 检查超时设置
    - 验证数据合并
    - 确认节点状态
3. **性能监控**
    - 观察响应时间
    - 检查资源使用
    - 监控错误率

## 路由说明

### 1. Success路由

触发条件：

- 所有节点执行成功
- 数据合并成功
- 未发生超时

### 2. Failure路由

触发条件：

- 执行超时
- 节点执行失败
- 合并结果失败

## 使用建议

1. **场景选择**
    - 适用于需要合并多个异步操作结果的场景
    - 适用于需要整合多个数据源的场景
    - 适用于并行API调用的场景
2. **配置优化**
    - 合理设置超时时间
    - 优化节点执行顺序
    - 完善错误处理机制
3. **监控维护**
    - 定期检查执行状态
    - 监控性能指标
    - 及时处理异常

汇聚节点是处理并行任务结果的关键组件，通过合理配置和使用，可以有效地整合多个数据源或服务的结果。在使用时要特别注意超时设置和错误处理，确保数据处理的可靠性和效率。
