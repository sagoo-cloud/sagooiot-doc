---
title: 'Modbus'
sidebar_position: 10
hide_title: true
keywords: [规则引擎,Modbus,数据采集,寄存器]
description: '详细介绍SagooIOT平台规则引擎中modbus节点的功能和使用方法'
---

Modbus节点执行 Modbus 协议的读取或写入操作。Modbus 组件支持 TCP 和 RTU 两种通信协议。

## 2. 配置参数

### 2.1 基本配置

- **节点ID**：唯一标识符，例如 `node_36`。
- **名称**：输入节点名称，便于识别。
- **服务器地址**：Modbus 服务器地址，格式为 `<mode>://<host:port>` 或 `<mode>://<serial device>`。例如：`tcp://127.0.0.1:502`。
- **Modbus 方法名称**：选择 Modbus 命令名称，如 `读取线圈状态`。
- **从机编号**：使用的单元编号（从机编号），格式为 uint8，例如 `1`。
- **寄存器地址**：允许使用 `${}` 占位符变量，格式为 uint16，例如 `50` 或 `0x32`。
- **寄存器数量**：允许使用 `${}` 占位符变量，例如 `1`。

### 2.2 寄存器类型

- **寄存器类型**：可选值：
    - `0`：保持寄存器（HOLDING_REGISTER）功能码：0x03
    - `1`：输入寄存器（INPUT_REGISTER）功能码：0x03

### 2.3 TCP 配置参数

- **超时时间**：请求超时时间，单位为秒，默认值为 `5`。
- **证书路径**：TLS/SSL 连接时需要提供。
- **私钥路径**：TLS/SSL 连接时需要提供。
- **CA 证书路径**：TLS/SSL 连接时需要提供。

### 2.4 RTU 配置参数

- **波特率**：串行波特率（仅 RTU 模式），默认值为 `19200`。
- **数据位数**：数据位数（仅 RTU 模式），默认值为 `8`。
- **校验位**：校验位（仅 RTU 模式），可选值：
    - `0`：无校验（PARITY_NONE）
    - `1`：偶校验（PARITY_EVEN）
    - `2`：奇校验（PARITY_ODD）
- **停止位数**：停止位数（仅 RTU 模式），默认值为 `2`。

### 2.5 编码配置参数

- **字节序**：寄存器的字节序，可选值：
    - `1`：大端（BIG_ENDIAN）
    - `2`：小端（LITTLE_ENDIAN）
- **字序**：32 位寄存器的字序，可选值：
    - `1`：高字在前（HIGH_WORD_FIRST）
    - `2`：低字在前（LOW_WORD_FIRST）

## 3. 命令说明

Modbus 组件支持多种命令，包括读取和写入操作。以下是一些常用命令及其参数描述：

### 3.1 读取命令

- **ReadCoils**：读取线圈状态
    - `address`：线圈起始地址
    - `quantity`：读取数量
- **ReadDiscreteInputs**：读取离散输入状态
    - `address`：离散输入起始地址
    - `quantity`：读取数量
- **ReadRegisters**：读取寄存器
    - `address`：寄存器起始地址
    - `quantity`：读取数量
    - `regType`：寄存器类型

### 3.2 写入命令

- **WriteCoil**：写入单个线圈状态
    - `address`：线圈地址
    - `value`：写入值（布尔值）
- **WriteRegisters**：写入多个寄存器
    - `address`：寄存器起始地址
    - `value`：写入值（16 位整数数组）

## 4. 关系类型

- **Success**：执行成功，把消息发送到 `Success` 链。
- **Failure**：执行失败，把消息发送到 `Failure` 链。

## 5. 执行结果

- **写操作**：不改变消息负荷值。
- **读操作**：返回一个数组，数组中的每个元素是一个对象，包含以下字段：
    - `unitId`：单元编号（从机编号）
    - `type`：数据类型，如 "uint16"
    - `address`：地址，标识数据存储位置
    - `value`：当前值，表示数据内容

## 6. 示例配置

以下是一个示例配置，用于读取线圈状态：

1. **节点ID**：`node_36`
2. **名称**：`Read Coil Status`
3. **服务器地址**：`tcp://127.0.0.1:502`
4. **Modbus 方法名称**：`读取线圈状态`
5. **从机编号**：`1`
6. **寄存器地址**：`50`
7. **寄存器数量**：`1`

## 7. 配置页面说明

根据提供的配置页面截图，以下是各部分的详细说明：

### 7.1 基本信息

- **节点ID**：输入节点的唯一标识符，例如 `node_36`。
- **名称**：输入节点名称，便于识别。
- **服务器地址**：输入 Modbus 服务器地址，格式为 `tcp://<host>:<port>` 或 `rtu://<serial device>`。例如：`tcp://127.0.0.1:502`。
- **Modbus 方法名称**：选择要执行的 Modbus 命令，例如 `读取线圈状态`。
- **从机编号**：输入从机编号，格式为 uint8，例如 `1`。
- **寄存器地址**：输入寄存器地址，允许使用 `${}` 占位符变量，格式为 uint16，例如 `50` 或 `0x32`。
- **寄存器数量**：输入寄存器数量，允许使用 `${}` 占位符变量，例如 `1`。

### 7.2 寄存器值和类型

- **寄存器值**：输入寄存器值，允许使用 `${}` 占位符变量。读操作不需要提供，写操作需要提供，例如 `0x01,0x01 true 51,52`。
- **寄存器类型**：选择寄存器类型，例如 `保持寄存器0x3`。

### 7.3 配置选项

- **TCP 配置**：点击展开 TCP 配置选项，设置超时时间、证书路径等。
- **RTU 配置**：点击展开 RTU 配置选项，设置波特率、数据位数、校验位、停止位数等。
- **编码配置**：点击展开编码配置选项，设置字节序和字序。

### 7.4 描述

- **描述**：输入节点描述，便于理解和管理。

## 8. 确认配置

完成所有配置后，点击“确认”按钮保存配置。如果需要取消配置，点击“取消”按钮。

## 9. 调试模式

页面右上角有一个“调试模式”开关，开启后可以进行调试操作，便于排查问题。

通过以上步骤，用户可以成功配置和使用 Modbus 组件，执行 Modbus 协议的读取或写入操作。
