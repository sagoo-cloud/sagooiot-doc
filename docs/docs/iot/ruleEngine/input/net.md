---
title: 'TCP/UDP服务'
sidebar_position: 8
hide_title: true
keywords: [规则引擎,TCP服务,UDP服务,网络协议,Socket通信,数据接收,编码转换,超时控制,正则匹配,数据解析]
description: '详细介绍SagooIOT平台规则引擎中TCP/UDP服务节点的功能和使用方法，包括协议配置、数据编码、路由规则、最佳实践等内容，帮助用户实现可靠的网络通信服务。'
---


TCP/UDP服务节点提供了基于TCP和UDP协议的网络通信功能，支持创建Socket服务器，接收和处理网络数据，并根据配置的规则转发到规则链进行处理。

## 节点配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符
- **名称**: 节点的显示名称
- **描述**: 添加对该节点的详细说明
- **调试模式**: 可开启调试模式查看数据收发情况

### 2. 服务配置

#### 基础配置
- **协议**: 选择通信协议（TCP/UDP）
- **监听地址**: 服务监听的地址和端口
  - 格式示例: `:6335`（监听所有网卡的6335端口）
  - 也可指定具体IP: `192.168.1.100:6335`

#### 高级配置
- **读取超时**: 数据读取超时时间，单位为秒
  - 默认值: 60秒
  - 设置为0表示不设置超时
- **编码方式**: 数据编码转换方式
  - hex: 转换为16进制字符串
  - base64: 转换为base64字符串
  - 空或其他: 不进行转换

### 3. 路由设置

在路由设置标签页中可以配置：

- **路由正则表达式**: 匹配数据的正则表达式规则
- **前置数据处理器**: 数据处理前的预处理逻辑
- **后置数据处理器**: 数据处理后的后处理逻辑

## 使用场景示例

### 1. TCP设备数据接收
```
# 配置示例
协议: TCP
监听地址: :6335
读取超时: 60
编码方式: hex
路由正则: ^(01|02|03).*
```

### 2. UDP广播接收
```
# 配置示例
协议: UDP
监听地址: :6335
读取超时: 30
编码方式: base64
路由正则: .*DATA.*
```

### 3. 二进制协议设备
```
# 配置示例
协议: TCP
监听地址: :6335
读取超时: 120
编码方式: hex
路由正则: ^AA55.*FF$
```

## 数据处理说明

### 1. 数据接收
- TCP模式下按\n或\t\n作为数据结束符
- UDP模式下每个数据包作为一个完整数据
- 支持配置读取超时机制

### 2. 数据编码
- hex编码: 将二进制数据转换为16进制字符串
- base64编码: 将二进制数据转换为base64字符串
- 原始数据: 不进行编码转换

### 3. 数据路由
- 使用正则表达式匹配数据
- 支持多个路由规则
- 按规则顺序进行匹配

## 最佳实践

### 1. 协议选择
- TCP用于可靠性要求高的场景
- UDP用于广播和实时性要求高的场景
- 根据设备协议特点选择合适的编码方式

### 2. 超时设置
- 根据业务需求设置合理的超时时间
- 考虑网络状况设置缓冲时间
- 特殊场景可以禁用超时

### 3. 路由配置
- 编写精确的正则表达式
- 处理好异常数据
- 配置默认路由处理未匹配数据

## 性能优化建议

### 1. 连接管理
- 控制最大连接数
- 及时清理断开的连接
- 实现连接池机制

### 2. 数据处理
- 使用高效的正则表达式
- 避免过度的数据转换
- 优化数据解析逻辑

### 3. 资源控制
- 监控内存使用
- 控制缓冲区大小
- 注意CPU使用率

## 调试建议

### 1. 数据测试
- 使用网络调试工具测试
- 验证数据格式和编码
- 测试异常情况处理

### 2. 性能测试
- 测试高并发连接
- 验证数据吞吐量
- 检查资源使用情况

### 3. 稳定性测试
- 长时间运行测试
- 模拟网络异常
- 压力测试

## 常见问题

### 1. 连接问题
- 检查端口占用
- 验证网络连通性
- 确认防火墙设置

### 2. 数据问题
- 检查数据格式
- 验证编码设置
- 测试正则表达式

### 3. 性能问题
- 优化正则表达式
- 调整缓冲区大小
- 控制并发连接数

## 示例代码

### 1. TCP客户端测试
```python
import socket

# 创建TCP客户端
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(('localhost', 6335))

# 发送数据
data = "Hello\n"
client.send(data.encode())

# 接收响应
response = client.recv(1024)
print(response.decode())

client.close()
```

### 2. UDP客户端测试
```python
import socket

# 创建UDP客户端
client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# 发送数据
data = "Hello"
client.sendto(data.encode(), ('localhost', 6335))

client.close()
```

通过合理配置TCP/UDP服务节点，您可以实现稳定可靠的网络通信服务。请根据实际需求选择合适的配置选项，并注意遵循安全和性能优化建议。
