---
title: 'Kafka服务'
sidebar_position: 12
hide_title: true
keywords: [规则引擎,Kafka,消息队列,数据处理,消息订阅]
description: '详细介绍SagooIOT平台规则引擎中Kafka节点的功能和使用方法，包括服务器配置、消费者组设置、主题订阅等内容，帮助用户实现可靠的消息队列服务。'
---


Kafka服务节点提供了基于Kafka的消息队列功能，支持订阅不同主题的数据，并根据配置的规则路由到规则链进行处理。该节点特别适合需要高吞吐量、可靠消息传递和实时数据处理的场景。

## 节点配置说明

### 1. 基本设置

- **节点ID**: 节点的唯一标识符
- **名称**: 节点的显示名称
- **描述**: 添加对该节点的详细说明
- **调试模式**: 可开启调试模式查看数据收发情况

### 2. Kafka连接配置

#### 基础配置
- **服务器地址**: Kafka服务器地址列表（必填）
  - 格式: `host:port`
  - 示例: `127.0.0.1:9092`
  - 多个地址使用逗号分隔，如: `127.0.0.1:9092,127.0.0.2:9092`
- **消费者组ID**: 消费者组的标识（v0.23.0+）
  - 默认值: `rulego`
  - 用于标识消费者分组，相同组的消费者共同消费消息

### 3. 路由设置

在路由设置页面，您可以：
- 添加订阅主题
- 配置前置数据处理器
- 配置后置数据处理器
- 设置消息路由规则

### 4. 响应配置

响应消息时需要在metadata中设置以下参数：
- **responseTopic**: 响应主题（必填）
- **partition**: 分区号（可选，默认0）
- **key**: 分区Key（可选）

## 使用场景示例

### 1. 基础消息订阅
```yaml
# 配置示例
brokers: ["127.0.0.1:9092"]
groupId: "rulego_group1"
```

### 2. 多服务器集群配置
```yaml
# 配置示例
brokers: ["127.0.0.1:9092", "127.0.0.2:9092", "127.0.0.3:9092"]
groupId: "rulego_cluster"
```

### 3. 指定分区消息发送
```yaml
# 消息响应示例
msg.Metadata.PutValue("responseTopic", "device.data")
msg.Metadata.PutValue("partition", "1")
msg.Metadata.PutValue("key", "device001")
msg.Data = "ok"
```

## 数据处理说明

### 1. 消息发布
- 支持指定响应主题
- 可设置分区和分区键
- 支持同步发送模式

### 2. 消息订阅
- 支持多主题订阅
- 支持消费者组负载均衡
- 支持自动提交偏移量

### 3. 错误处理
- 连接错误自动重试
- 消息处理异常捕获
- 支持自定义错误处理逻辑

## 最佳实践

### 1. 性能优化
- 合理设置消费者组
- 适当配置分区数
- 批量处理消息

### 2. 高可用配置
- 使用多broker部署
- 启用消息持久化
- 配置适当的副本因子

### 3. 监控建议
- 监控消费延迟
- 关注消息积压情况
- 检查消费者组状态

## 调试建议

### 1. 常见问题
- 连接超时：检查服务器地址配置
- 消费者组冲突：确认groupId设置
- 消息丢失：检查提交策略

### 2. 调试工具
- 使用调试模式查看数据流
- 检查Kafka日志
- 使用Kafka管理工具验证

## 配置示例

### 1. 基础配置
```yaml
brokers: ["127.0.0.1:9092"]
groupId: "rulego"
```

### 2. 高可用配置
```yaml
brokers: ["kafka1:9092", "kafka2:9092", "kafka3:9092"]
groupId: "rulego_ha"
```

通过合理配置Kafka节点，您可以实现可靠的消息队列服务。请根据实际需求选择合适的配置选项，并注意遵循性能优化和安全建议。如果遇到问题，请参考调试建议和常见问题解决方案。
